<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON Link Extractor from .DB and JSON</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
    }
    #dropzone {
      border: 2px dashed #888;
      padding: 2rem;
      text-align: center;
      margin-bottom: 1rem;
      color: #555;
    }
    #output a {
      display: block;
      margin: 0.3rem 0;
    }
    .file-section {
      margin-top: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h2>Select or Drop a .DB or .JSON File</h2>
  <input type="file" id="fileInput" accept=".db,.json" multiple>
  <div id="dropzone">Or drop a .DB or .JSON file here</div>
  <div id="output"></div>

  <script>
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const output = document.getElementById("output");

    // Drag & Drop
    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropzone.style.borderColor = "green";
    });

    dropzone.addEventListener("dragleave", () => {
      dropzone.style.borderColor = "#888";
    });

    dropzone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropzone.style.borderColor = "#888";
      for (const file of e.dataTransfer.files) {
        handleFile(file);
      }
    });

    // File input
    fileInput.addEventListener("change", () => {
      for (const file of fileInput.files) {
        handleFile(file);
      }
    });

    // Handle File
    function handleFile(file) {
      const section = document.createElement("div");
      section.className = "file-section";
      section.innerHTML = `<strong>Reading: ${file.name}</strong>`;
      output.appendChild(section);

      const reader = new FileReader();
      reader.onload = () => {
        try {
          if (file.name.endsWith(".json")) {
            const json = JSON.parse(reader.result);
            if (Array.isArray(json.pieces)) {
              const urls = json.pieces.map(p => p.url).filter(Boolean);
              section.innerHTML += `<p>Found ${urls.length} URL(s) from JSON:</p>`;
              urls.forEach(url => {
                const a = document.createElement("a");
                a.href = url;
                a.textContent = url;
                a.target = "_blank";
                a.download = url.split("/").pop();
                section.appendChild(a);

              });
            } else {
              section.innerHTML += "<p>No 'pieces' array found in JSON.</p>";
            }
          } else if (file.name.endsWith(".db")) {
            const content = new Uint8Array(reader.result);
            const text = new TextDecoder("utf-8", { fatal: false }).decode(content);
            const jsonRegex = /(?:https?:\/\/|\/)?[^\s"'<>]+?\.json\b(?:\?[^\s"'<>]*)?/gi;
            const matches = [...new Set(text.match(jsonRegex) || [])];

            if (matches.length === 0) {
              section.innerHTML += "<p>No .json links found in .db.</p>";
              return;
            }

            section.innerHTML += `<p>Found ${matches.length} .json link(s):</p>`;
            matches.forEach((link) => {
              const a = document.createElement("a");
              a.href = link.startsWith("http") ? link : "#" + link;
              a.textContent = link;
              a.download = link.split("/").pop();
              a.target = "_blank";
              section.appendChild(a);
            });
          } else {
            section.innerHTML += "<p>Unsupported file type.</p>";
          }
        } catch (err) {
          section.innerHTML += `<p>Error reading file: ${err.message}</p>`;
        }
      };
      reader.onerror = () => {
        section.innerHTML += "<p>Failed to read file.</p>";
      };

      if (file.name.endsWith(".json")) {
        reader.readAsText(file);
      } else {
        reader.readAsArrayBuffer(file);
      }
    }
  </script>
</body>
</html>
